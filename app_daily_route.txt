@app.route('/api/generate_daily_detail', methods=['POST'])
def generate_daily_detail():
    data_content = load_data()
    profile = data_content['profile']
    
    now = datetime.now()
    now_kst = now.strftime('%Y-%m-%d')
    
    prompt = f"""
    당신은 AI 코치입니다.
    **목표**: 오늘부터 딱 30일간의 **상세 일일 계획(Daily Plan)**을 수립하세요.

    [상황]
    - 오늘: {now_kst}
    - 시험: {profile.get('exam_type')}

    [요청: 30일 일일 계획]
    - **기간**: 오늘({now_kst})부터 30일간 (하루도 빠짐없이)
    - **내용**: 하루당 핵심 Task 3개 생성
    - **제약**: Task Title은 15자 이내로 짧게.

    [결과 형식 - JSON]
    {{
        "plans": [ {{ "date": "YYYY-MM-DD", "tasks": [...] }} ]
    }}
    """
    
    try:
        response = client.models.generate_content(
            model="gemini-2.0-flash", contents=prompt,
            config=types.GenerateContentConfig(response_mime_type="application/json", max_output_tokens=8192)
        )
        parsed = json.loads(response.text.replace("```json", "").replace("```", "").strip())
        return jsonify(parsed)
    except Exception as e:
        print(f"Error generating daily detail: {e}")
        return jsonify({"error": str(e)}), 500
